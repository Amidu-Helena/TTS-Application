<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Text to Speech App - React Version</title>
  <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
  <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
  <script src="https://unpkg.com/axios/dist/axios.min.js"></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  <style>
    body {
      font-family: 'Comic Sans MS', cursive, sans-serif;
      background: linear-gradient(135deg, #ff9a9e, #fad0c4, #fbc2eb, #a6c1ee);
      display: flex;
      justify-content: center;
      align-items: center;
      height: 100vh;
      margin: 0;
      padding: 20px;
      overflow: hidden;
    }

    .container {
      background: #fffafc;
      padding: 30px;
      border-radius: 20px;
      box-shadow: 0px 8px 25px rgba(255, 105, 180, 0.3);
      width: 400px;
      max-width: 100%;
      text-align: center;
      animation: fadeIn 1s ease-in-out;
      border: 3px solid #ffb6c1;
      z-index: 2;
      position: relative;
    }

    h2 {
      color: #ff69b4;
      margin-bottom: 15px;
      font-size: 24px;
    }

    textarea {
      width: 100%;
      padding: 12px;
      border: 2px solid #ffb6c1;
      border-radius: 12px;
      outline: none;
      resize: none;
      font-size: 14px;
      box-sizing: border-box;
      background: #fff0f6;
    }

    select, button {
      margin-top: 15px;
      padding: 12px;
      font-size: 14px;
      border-radius: 12px;
      border: none;
      cursor: pointer;
      width: 100%;
    }

    select {
      border: 2px solid #ffb6c1;
      background: #fff0f6;
      color: #d63384;
    }

    button {
      background: linear-gradient(90deg, #ff85a2, #ffcc70);
      color: white;
      font-weight: bold;
      transition: transform 0.2s ease, background 0.3s ease;
    }

    button:hover:not(:disabled) {
      transform: scale(1.05);
      background: linear-gradient(90deg, #ff99c8, #ffe066);
    }

    button:disabled {
      opacity: 0.6;
      cursor: not-allowed;
      transform: none;
    }

    audio {
      margin-top: 20px;
      width: 100%;
    }

    h3 {
      color: #ff69b4;
      margin-top: 20px;
    }

    @keyframes fadeIn {
      from {opacity: 0; transform: translateY(-20px);}
      to {opacity: 1; transform: translateY(0);}
    }

    .heart {
      position: absolute;
      color: #ff69b4;
      font-size: 20px;
      animation: floatUp 6s linear infinite;
      opacity: 0.8;
    }

    @keyframes floatUp {
      0% { transform: translateY(100vh) scale(1); opacity: 1; }
      100% { transform: translateY(-10vh) scale(1.5); opacity: 0; }
    }

    .error-message {
      color: #ff4757;
      background: #ffe6e6;
      padding: 10px;
      border-radius: 8px;
      margin-top: 10px;
      font-size: 14px;
    }

    .loading-spinner {
      display: inline-block;
      width: 20px;
      height: 20px;
      border: 3px solid #ffffff;
      border-radius: 50%;
      border-top-color: transparent;
      animation: spin 1s ease-in-out infinite;
    }

    @keyframes spin {
      to { transform: rotate(360deg); }
    }

    @media (max-width: 600px) {
      .container {
        padding: 20px;
        width: 100%;
      }
      textarea {
        font-size: 16px;
      }
      button, select {
        font-size: 16px;
        padding: 14px;
      }
    }
  </style>
</head>
<body>
  <div id="root"></div>

  <script type="text/babel">
    const { useState, useEffect } = React;

    // API Service
    class TTSService {
      static async convertText(text, voice = 'Joanna') {
        const API_URL = 'https://b43ymaoq6e.execute-api.us-east-1.amazonaws.com/prod';
        
        try {
          console.log('Converting text:', { text: text.substring(0, 50) + '...', voice });
          
          const response = await axios.post(`${API_URL}/convert`, {
            text,
            voice
          }, {
            timeout: 30000,
            headers: {
              'Content-Type': 'application/json',
            }
          });

          console.log('Conversion successful:', response.data);
          return response.data;
          
        } catch (error) {
          console.error('TTS Service Error:', error);
          
          // Try alternative approach if main API fails
          if (error.message.includes('CORS') || error.message.includes('Network')) {
            console.log('Trying alternative API call...');
            return await this.convertTextAlternative(text, voice);
          }
          
          throw error;
        }
      }

      // Alternative method using fetch
      static async convertTextAlternative(text, voice = 'Joanna') {
        try {
          console.log('Trying alternative API call...');
          
          const response = await fetch('https://b43ymaoq6e.execute-api.us-east-1.amazonaws.com/prod/convert', {
            method: 'POST',
            headers: {
              'Content-Type': 'application/json',
              'Accept': 'application/json',
            },
            mode: 'cors',
            credentials: 'omit',
            body: JSON.stringify({ text, voice })
          });

          if (!response.ok) {
            const errorText = await response.text();
            throw new Error(`HTTP ${response.status}: ${errorText}`);
          }

          const data = await response.json();
          console.log('Alternative API call successful:', data);
          return data;
          
        } catch (error) {
          console.error('Alternative API call failed:', error);
          throw new Error(`API call failed: ${error.message}`);
        }
      }
    }

    function App() {
      const [text, setText] = useState('');
      const [voice, setVoice] = useState('Joanna');
      const [audioUrl, setAudioUrl] = useState('');
      const [isLoading, setIsLoading] = useState(false);
      const [error, setError] = useState('');
      const [hearts, setHearts] = useState([]);

      // Floating hearts animation
      useEffect(() => {
        const interval = setInterval(() => {
          const newHeart = {
            id: Date.now(),
            left: Math.random() * 100,
            fontSize: Math.random() * 20 + 15,
            duration: Math.random() * 4 + 3
          };
          
          setHearts(prev => [...prev, newHeart]);
          
          // Remove heart after animation
          setTimeout(() => {
            setHearts(prev => prev.filter(heart => heart.id !== newHeart.id));
          }, 6000);
        }, 700);

        return () => clearInterval(interval);
      }, []);

      const handleConvertText = async () => {
        if (!text.trim()) {
          setError('Please type some text!');
          return;
        }

        setIsLoading(true);
        setError('');
        setAudioUrl('');

        try {
          const result = await TTSService.convertText(text, voice);
          
          if (result.audio_url) {
            setAudioUrl(result.audio_url);
          } else if (result.isBase64Encoded) {
            // Handle base64 audio
            const audioBlob = new Blob([result.body], { type: 'audio/mpeg' });
            const url = URL.createObjectURL(audioBlob);
            setAudioUrl(url);
          } else {
            throw new Error('Unexpected response format');
          }
        } catch (err) {
          console.error('Error converting text:', err);
          setError(`Failed to generate audio: ${err.message}`);
        } finally {
          setIsLoading(false);
        }
      };

      const voices = [
        { value: 'Joanna', label: 'Joanna' },
        { value: 'Matthew', label: 'Matthew' },
        { value: 'Amy', label: 'Amy' },
        { value: 'Brian', label: 'Brian' }
      ];

      return (
        <div className="app">
          <div id="hearts">
            {hearts.map(heart => (
              <div
                key={heart.id}
                className="heart"
                style={{
                  left: `${heart.left}vw`,
                  fontSize: `${heart.fontSize}px`,
                  animationDuration: `${heart.duration}s`
                }}
              >
                ðŸ’–
              </div>
            ))}
          </div>

          <div className="container">
            <h2>ðŸŒ¸ Text to Speech ðŸŽ€</h2>

            <textarea
              id="textInput"
              rows="5"
              placeholder="Type something cute..."
              value={text}
              onChange={(e) => setText(e.target.value)}
            />

            <label htmlFor="voice">ðŸ’– Choose a voice:</label>
            <select
              id="voice"
              value={voice}
              onChange={(e) => setVoice(e.target.value)}
            >
              {voices.map(voiceOption => (
                <option key={voiceOption.value} value={voiceOption.value}>
                  {voiceOption.label}
                </option>
              ))}
            </select>

            <button
              id="speakBtn"
              onClick={handleConvertText}
              disabled={isLoading}
            >
              {isLoading ? (
                <>
                  <span className="loading-spinner"></span> Generating...
                </>
              ) : (
                'âœ¨ Speak âœ¨'
              )}
            </button>

            {error && (
              <div className="error-message">
                {error}
              </div>
            )}

            <h3>ðŸŽ§ Output:</h3>
            {audioUrl && (
              <audio
                id="audioPlayer"
                controls
                src={audioUrl}
                autoPlay
              />
            )}
          </div>
        </div>
      );
    }

    // Render the app
    ReactDOM.render(<App />, document.getElementById('root'));
  </script>
</body>
</html>
